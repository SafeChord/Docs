# KDD (Knowledge-Driven Development) - 第二階段：透過泛型模板與 TDD 驅動的語意標記

**最後更新日期：** 2025年5月17日

## 1. 核心目標 (Core Objective)

* 在 KDD 第一階段產出的「專案的高階描述語言」（即知識樹結構文件和初步的節點描述文件）的基礎上，進一步**細化和豐富知識樹中「關鍵節點」的語意信息**。
* 核心是使這些節點的描述足夠詳細和結構化，以便能夠**精準地指導 KDD 第三階段的 Engineering AI（或輔助工具）生成具體的開發構件**（如程式碼、API 文件、測試腳本等）。
* 此階段強調將抽象的設計意圖轉化為更接近「可執行規格」的描述。

## 2. 核心理念與實踐路徑 (Core Concepts & Practical Path)

* **泛型模板 (Generic Templates) 的應用：**
    * 針對不同類型的「關鍵節點」（如 API 服務、數據模型、業務邏輯單元），設計和應用標準化的 Markdown「泛型模板」。
    * 這些模板引導人類工程師提供必要的結構化語意信息。
    * **示例：** 您提供的 `safechord.safezone.service.datasimulator.md` 文件本身就是一個針對「API 服務」節點的優秀模板實例，包含了服務描述、需求、建議目錄結構、`tech_stack` 以及詳細的 TDD Case。
* **TDD 文件作為核心語意規格 (TDD Artifacts as Core Semantic Specifications)：**
    * Markdown 文件中詳細的「單元測試」和「整合測試」描述（尤其是 TestCase 表格，包含測試項目、模組、描述和預期結果）成為定義節點行為和接口的關鍵。
    * 這些 TDD Case 不僅用於後續測試，更在設計階段就充當了驅動 API 結構和數據模型（如 Pydantic 模型）設計的「規格說明書」。
* **Markdown 作為語意標記載體：**
    * 利用 Markdown 的元數據 (Frontmatter)、正文標題、列表、表格和程式碼塊 (用於展示如 JSON/YAML 結構示例或建議目錄結構) 來承載詳細的、結構化的語意信息。
    * 這種方式兼顧了「人類可讀寫性」和「機器可解析性」。
* **簡化 AI 互動，強化人類設計主導：**
    * 相較於完全依賴 AI 從零開始理解複雜需求，此階段更側重於人類工程師按照模板和 TDD 思想主動「填寫」和「設計」詳細規格。
    * AI 的角色可以是在此基礎上進行解析、轉換，或在模板填充過程中提供輔助（如基於已有信息推薦相關內容）。
* **API 基礎模板與通用約定：**
    * 通用的 API 設計模式（如所有服務包含 `/health` 端點、標準化的錯誤處理機制）可以定義在更高層次的 KDD 文件中，或作為「KDD 解析器/Prompt Compiler」的內置規則，自動應用到生成的服務骨架中。

## 3. 工作流程與輸入輸出 (Workflow & Inputs/Outputs)

### 3.1 輸入 (Inputs)

* **KDD 第一階段的輸出：**
    * 結構樹文件 (`*.knowledgetree.md`)。
    * 核心/已定義節點的初步描述文件 (`*.md`)，包含元數據和初步 `summary`。
* **泛型模板 (Generic Templates)：** 針對待標記「關鍵節點」類型的 Markdown 結構模板。
* **人類工程師的設計決策：** 關於 API 設計、數據結構、核心邏輯、測試覆蓋範圍等的具體思考。

### 3.2 核心活動 (Core Activities)

1.  **識別關鍵節點：** 從知識樹中選定需要進行詳細語意標記的節點（例如，一個 API 服務節點）。
2.  **應用泛型模板：** 人類工程師基於選定的「泛型模板」，在對應的 Markdown 文件中開始填充詳細信息。
3.  **詳細化服務/模組描述：**
    * 明確服務的核心功能需求、非功能需求。
    * （可選）建議詳細的目錄結構、關鍵組件。
    * 在 Frontmatter 中明確或更新 `tech_stack` 等元數據。
4.  **設計並記錄 TDD Case：**
    * 針對節點的核心功能和 API 接口，設計詳細的單元測試和整合測試案例。
    * 在 Markdown 文件中使用表格等形式清晰記錄每個 TestCase 的測試項目、測試模組/API 端點、詳細的測試描述（包括輸入條件、操作步驟）以及明確的預期結果（包括成功時的狀態碼、響應體結構或關鍵數據；失敗時的狀態碼和錯誤信息）。
    * **重點：** 預期結果的描述應盡可能包含結構化信息（如 JSON 示例片段），以便 AI 推斷數據模型。
5.  **（可選）草擬數據模型：** 人類工程師可以直接在 Markdown 中使用 JSON/YAML 程式碼塊初步草擬 Pydantic 模型或其他數據結構的定義，或更依賴後續工具從 TDD Case 中推斷。
6.  **審核與迭代：** 人類工程師審核標記的完整性、一致性和準確性。

### 3.3 輸出 (Outputs) - 增強的、富含詳細語意的節點描述文件

* **經過詳細語意標記的 Markdown 文件：**
    * 在第一階段文件的基礎上，增加了大量結構化的語意信息，特別是關於 API 接口定義、數據結構（隱含在 TDD Case 或直接草擬）、核心邏輯步驟以及詳細的測試案例。
    * 這些文件成為了更精確的「Prompt Code」或更詳細的「AST 節點」，為 KDD 第三階段的程式碼生成提供了堅實的基礎。
    * **示例：** 您提供的 `safechord.safezone.service.datasimulator.md` 就是此階段輸出的絕佳範例。

## 4. 人機協同模式 (Human-AI Collaboration)

* **人類主導設計與規格定義：** 此階段的核心是人類工程師根據其專業知識和設計決策，按照模板填充詳細的規格信息，特別是 TDD Case 的設計。
* **AI 潛在輔助角色（未來展望）：**
    * **模板填充建議：** AI 可基於節點類型和上下文，提示工程師需要填寫哪些模板字段。
    * **從 TDD Case 初步推斷：** AI 可嘗試從 TDD Case 的描述中初步提取 API 端點、參數、響應結構的建議。
    * **一致性檢查：** AI 可輔助檢查不同 TDD Case 之間或與節點其他描述部分的一致性。
    * **Pydantic 模型草稿生成：** 基於 TDD Case 中的 JSON 示例或結構描述，AI 輔助生成 Pydantic 模型的初步草稿。

## 5. 未來展望與「KDD 解析器/Prompt Compiler」

* KDD 第二階段的輸出（詳細標記的 Markdown 文件）是「KDD 解析器/Prompt Compiler」理想的處理對象。
* 該工具的核心職責是解析這些 Markdown 文件，提取結構化的語意信息（特別是從 TDD Case 中提煉 API 結構和數據模型），然後將其轉換為針對特定 Engineering AI（如 `cline` 後端的 LLM 或其他程式碼生成模型）的高質量、可執行的 Prompts。

---

**討論備註：**

* 此階段的成功關鍵在於「泛型模板」的設計質量和 TDD Case 描述的清晰度與結構化程度。
* 雖然目前您是手動編寫程式碼，但通過 KDD 第二階段的實踐（即使只是文檔層面），可以為未來引入 AI 輔助程式碼生成打下堅實基礎，並使專案設計本身更清晰、更易於維護。
